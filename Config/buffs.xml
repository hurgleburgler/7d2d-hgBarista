<hurgleburgler>

  <append xpath="/buffs/buff[@name='god']/effect_group">
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="debuffCursed"/>
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffTooMuchCaffeine"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffColdResistDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffHeatResistDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffParkourBoostDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffBearStrengthDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffPumpkinClubBonusDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffBulletproofCoffeeDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffLondonFogStealthDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDragonsBreathDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffApexPeakDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffDragonsBreath"/>
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffApexCrash"/>
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffPhoenixRebirth"/>
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffPhoenixFire"/>
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffGrandpasInfection"/>
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffGrandpasLegacy"/>
  </append>

  <insertAfter xpath="/buffs/buff[@name='buffBlackStrapCoffee']/effect_group/triggered_effect[@action='RemoveBuff' and @buff='buffCoffee']">
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffCaffeine"/>
  </insertAfter>

  <insertAfter xpath="/buffs/buff[@name='buffCoffee']/effect_group/triggered_effect[@action='RemoveBuff' and @buff='buffBlackStrapCoffee']">
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffCaffeine"/>
  </insertAfter>

  <append xpath="/buffs">

    <buff name="debuffCursed" name_key="debuffCursedCoffee" description_key="debuffCursedCoffeeDesc" icon="ui_game_symbol_skull" icon_color="0,255,0" icon_blink="true">
      <stack_type value="ignore"/>

      <effect_group tiered="false">
        <!-- Apply stat penalties -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="Health" operation="add" value="@$debuffCursedHealthPenalty"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="water" operation="add" value="@$debuffCursedWaterPenalty"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="stamina" operation="set" value="@$debuffCursedStaminaRegen"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="food" operation="add" value="@$debuffCursedFoodPenalty"/>
        <passive_effect name="StaminaChangeOT" operation="base_set" value="@$debuffCursedStaminaRegen"/>
      </effect_group>

      <effect_group>
        <!-- Clean up -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$debuffCursedHealthPenalty" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$debuffCursedWaterPenalty" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$debuffCursedFoodPenalty" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$debuffCursedStaminaRegen" operation="set" value="0"/>
      </effect_group>
    </buff>

    <buff name="debuffTooMuchCaffeine" name_key="buffTooMuchCaffeineName" description_key="debuffTooMuchCaffeineDesc" icon="ui_game_symbol_food_poisoning" icon_color="255,0,0" icon_blink="true">
      <damage_type value="Dehydration"/>
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".debuffTooMuchCaffeineDisplay"/>
      <display_value_format value="time"/>

      <!-- Duration Setup -->
      <effect_group>

        <!-- Initial setup only -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$tooMuchCaffeineStackDuration" operation="set" value="@$debuffTooMuchCaffeineDuration"/>

        <!-- Will be called for subsequent stacks -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$tooMuchCaffeineStackDuration" operation="add" value="@$debuffTooMuchCaffeineDuration"/>


        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$tooMuchCaffeineStackDuration" operation="subtract" value="1"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".debuffTooMuchCaffeineDisplay" operation="set" value="@$tooMuchCaffeineStackDuration"/>

        <!-- Remove buff when duration expires -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="debuffTooMuchCaffeine">
          <requirement name="CVarCompare" cvar="$tooMuchCaffeineStackDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Clean up variables -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".debuffTooMuchCaffeineDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$debuffTooMuchCaffeineDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$tooMuchCaffeineStackDuration" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Visual effects -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="1" effect_name="Distortion"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="1" effect_name="Distortion"/>

        <!-- Sound effect -->
        <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="Player$Thirsty" play_in_head="true"/>

<!--        &lt;!&ndash; Apply dehydration debuff &ndash;&gt;
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="dehydrateAmount" operation="set" value="50"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="dehydrateOverTime" operation="set" value="10"/>
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="debuffDehydrate"/>

        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="dehydrateAmount" operation="set" value="50"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="dehydrateOverTime" operation="set" value="10"/>
        <triggered_effect trigger="onSelfBuffStack" action="AddBuff" buff="debuffDehydrate"/>-->

        <!-- Fatigue after effect -->
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffCaffeineFatigue"/>

      </effect_group>
    </buff>

    <buff name="buffCaffeineFatigue" name_key="buffFatiguedName" description_key="buffFatiguedDesc" icon="ui_game_symbol_fatigued" icon_color="255,128,0">
      <damage_type value="Disease"/>
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".fatiguedDurationDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Duration setup -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$fatiguedCounter" operation="set" value="7208"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$fatiguedCounter" operation="set" value="7208"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$fatiguedCounter" operation="subtract" value="@$critHitNaturalHealingRate"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fatiguedDurationDisplay" operation="set" value="@$fatiguedCounter"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fatiguedDurationDisplay" operation="divide" value="@$critHitNaturalHealingRate"/>

        <!-- Remove when done -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffCaffeineFatigue">
          <requirement name="CVarCompare" cvar="$fatiguedCounter" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Cleanup -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$fatiguedCounter" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".fatiguedDurationDisplay" operation="set" value="0"/>
      </effect_group>

      <!-- Core fatigue effects without infection vector -->
      <effect_group>
        <passive_effect name="BuffBlink" operation="base_set" value="2" duration="0,3" tags="buffCaffeineFatigue"/>
        <passive_effect name="HealthLoss" operation="perc_add" value=".1"/>
      </effect_group>
    </buff>

    <buff name="debuffDehydrate" name_key="buffDehydrateName" description_key="buffDehydrateDesc" icon="ui_game_symbol_thirst" icon_color="255,0,0" icon_blink="true">
      <damage_type value="Dehydration"/>
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".dehydrateDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Initial setup -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$dehydratePointsRemaining" operation="set" value="@dehydrateAmount"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$dehydrateTimeRemaining" operation="set" value="@dehydrateDuration"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$dehydratePerSecond" operation="set" value="@dehydrateAmount"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$dehydratePerSecond" operation="divide" value="@dehydrateDuration"/>

        <!-- Stack handling -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$dehydratePointsRemaining" operation="add" value="@dehydrateAmount"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$dehydrateTimeRemaining" operation="add" value="@dehydrateDuration"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$dehydratePerSecond" operation="set" value="@$dehydratePointsRemaining"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$dehydratePerSecond" operation="divide" value="@$dehydrateTimeRemaining"/>

        <!-- Per tick updates -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="water" operation="subtract" value="@$dehydratePerSecond"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$dehydratePointsRemaining" operation="subtract" value="@$dehydratePerSecond"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$dehydrateTimeRemaining" operation="subtract" value="1"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".dehydrateDisplay" operation="set" value="@$dehydrateTimeRemaining"/>
      </effect_group>

      <effect_group>
        <!-- End buff when duration expires -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="debuffDehydrate">
          <requirement name="CVarCompare" cvar="$dehydrateTimeRemaining" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Cleanup -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$dehydrateTimeRemaining" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$dehydratePointsRemaining" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$dehydratePerSecond" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".dehydrateDisplay" operation="set" value="0"/>
      </effect_group>
    </buff>

    <buff name="buffCaffeine" name_key="drinkJarCoffee" description_key="drinkJarCoffeeDesc" icon="ui_game_symbol_coffee">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffCaffeineDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Increment counter on new stack -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$coffeeConsumedCount" operation="add" value="1"/>

        <!-- Check for too much coffee -->
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffTooMuchCaffeine">
          <requirement name="CVarCompare" cvar="$coffeeConsumedCount" operation="GTE" value="10"/>
        </triggered_effect>

        <!-- Duration cap check -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="set" value="@$buffCaffeineDurationMax">
          <requirement name="CVarCompare" cvar="$buffCaffeineDuration" operation="GT" value="@$buffCaffeineDurationMax"/>
        </triggered_effect>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffCaffeineDisplay" operation="set" value="@$buffCaffeineDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffCaffeineDisplay" operation="divide" value="@$MetabolismDuration"/>

        <!-- Apply dehydration on start -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="dehydrateAmount" operation="set" value="@$buffCaffeineDehydration"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="dehydrateDuration" operation="set" value="60"/>
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="debuffDehydrate"/>

        <!-- Apply dehydration on stack -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="dehydrateAmount" operation="set" value="@$buffCaffeineDehydration"/>
         <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="dehydrateDuration" operation="set" value="60"/>
        <triggered_effect trigger="onSelfBuffStack" action="AddBuff" buff="debuffDehydrate"/>
      </effect_group>

      <effect_group>
        <!-- Buff removal and cleanup -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffCaffeine">
          <requirement name="CVarCompare" cvar="$buffCaffeineDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Reset counter when buff expires -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$coffeeConsumedCount" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffCaffeineDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffCaffeineStaminaRegen" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffCaffeineDehydration" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Stamina effects with water healing consideration -->
        <passive_effect name="StaminaChangeOT" operation="perc_add" value="@$buffCaffeineStaminaRegen">
          <requirement name="!HasBuff" buff="buffHealWaterMax"/>
        </passive_effect>

        <passive_effect name="StaminaChangeOT" operation="perc_add" value="0.1">
          <requirement name="HasBuff" buff="buffHealWaterMax"/>
        </passive_effect>

        <!-- Base dehydration effect -->
        <passive_effect name="WaterLossPerStaminaPointGained" operation="perc_add" value="@$buffCaffeineDehydration"/>
      </effect_group>
    </buff>

    <buff name="buffColdResist" name_key="buffColdResist" description_key="buffColdResistDesc" icon="ui_game_symbol_cold" icon_color="0,102,204">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffColdResistDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Duration cap check -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$buffColdResistDuration" operation="set" value="@$buffColdResistDurationMax">
          <requirement name="CVarCompare" cvar="$buffColdResistDuration" operation="GT" value="@$buffColdResistDurationMax"/>
        </triggered_effect>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffColdResistDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffColdResistDisplay" operation="set" value="@$buffColdResistDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffColdResistDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <!-- Remove buff when duration expires -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffColdResist">
          <requirement name="CVarCompare" cvar="$buffColdResistDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Clean up variables -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffColdResistDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffColdResistDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffColdResistValue" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Apply the cold resistance effect -->
        <passive_effect name="HypothermalResist" operation="base_add" value="@$buffColdResistValue"/>
        <passive_effect name="HyperthermalResist" operation="base_subtract" value="10"/>
      </effect_group>
    </buff>

    <buff name="buffHeatResist" name_key="buffHeatResist" description_key="buffHeatResistDesc" icon="ui_game_symbol_hot" icon_color="204,102,0">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffHeatResistDisplay"/>
      <display_value_format value="time"/>

      <!-- Set up cold vulnerability value -->
      <effect_group>
        <!-- Initialize vulnerability value -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$currentColdVulnerability" operation="set" value="10"/>
        <!-- Override with custom value if present -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$currentColdVulnerability" operation="set" value="@$buffColdVulnerability">
          <requirement name="CVarCompare" cvar="$buffColdVulnerability" operation="GT" value="0"/>
        </triggered_effect>

        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$currentColdVulnerability" operation="set" value="@$buffColdVulnerability">
          <requirement name="CVarCompare" cvar="$buffColdVulnerability" operation="GT" value="0"/>
        </triggered_effect>
      </effect_group>

      <effect_group>
        <!-- Duration cap check -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$buffHeatResistDuration" operation="set" value="@$buffHeatResistDurationMax">
          <requirement name="CVarCompare" cvar="$buffHeatResistDuration" operation="GT" value="@$buffHeatResistDurationMax"/>
        </triggered_effect>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffHeatResistDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffHeatResistDisplay" operation="set" value="@$buffHeatResistDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffHeatResistDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <!-- Remove buff when duration expires -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffHeatResist">
          <requirement name="CVarCompare" cvar="$buffHeatResistDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Clean up variables -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffHeatResistDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffHeatResistDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffHeatResistValue" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$currentColdVulnerability" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffColdVulnerability" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Apply the heat resistance effect -->
        <passive_effect name="HyperthermalResist" operation="base_add" value="@$buffHeatResistValue"/>
        <passive_effect name="HypothermalResist" operation="base_subtract" value="@$currentColdVulnerability"/>
      </effect_group>
    </buff>

    <buff name="buffDiseaseResist" name_key="buffDiseaseResist" description_key="buffDiseaseResistDesc" icon="ui_game_symbol_natural_healing" icon_color="0,153,76">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffDiseaseResistDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffDiseaseResistDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffDiseaseResistDisplay" operation="set" value="@$buffDiseaseResistDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffDiseaseResistDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$buffDiseaseResistDuration" operation="set" value="@$buffDiseaseResistDurationMax">
          <requirement name="CVarCompare" cvar="$buffDiseaseResistDuration" operation="GT" value="@$buffDiseaseResistDurationMax"/>
        </triggered_effect>

        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffDiseaseResist">
          <requirement name="CVarCompare" cvar="$buffDiseaseResistDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffDiseaseResistDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffDiseaseResistDuration" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <passive_effect name="BuffResistance" operation="base_add" value="@$buffDiseaseResistValue" tags="buffInfectionCatch,buffDysenteryCatchFood,buffDysenteryCatchDrink"/>
      </effect_group>
    </buff>

    <buff name="buffStaminaEfficiency" name_key="buffStaminaEfficiency" description_key="buffStaminaEfficiencyDesc" icon="ui_game_symbol_stamina" icon_color="0,153,153">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffStaminaEfficiencyDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Duration cap check -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$buffStaminaEfficiencyDuration" operation="set" value="@$buffStaminaEfficiencyDurationMax">
          <requirement name="CVarCompare" cvar="$buffStaminaEfficiencyDuration" operation="GT" value="@$buffStaminaEfficiencyDurationMax"/>
        </triggered_effect>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffStaminaEfficiencyDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffStaminaEfficiencyDisplay" operation="set" value="@$buffStaminaEfficiencyDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffStaminaEfficiencyDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <!-- Remove buff when duration expires -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffStaminaEfficiency">
          <requirement name="CVarCompare" cvar="$buffStaminaEfficiencyDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Clean up variables -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffStaminaEfficiencyDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffStaminaEfficiencyDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffStaminaEfficiencyValue" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Apply stamina efficiency effects -->
        <passive_effect name="FoodLossPerStaminaPointGained" operation="perc_add" value="@$buffStaminaEfficiencyValue"/>
        <passive_effect name="WaterLossPerStaminaPointGained" operation="perc_add" value="@$buffStaminaEfficiencyValue"/>
      </effect_group>
    </buff>

    <buff name="buffParkourBoost" name_key="buffParkourBoost" description_key="buffParkourBoostDesc" icon="ui_game_symbol_parkour" icon_color="102,0,204">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffParkourBoostDisplay"/>
      <display_value_format value="time"/>

      <!-- Jump stack initialization -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$parkourJumpStacks" operation="set" value="1"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$parkourJumpStacks" operation="add" value="1">
          <requirement name="CVarCompare" cvar="$parkourJumpStacks" operation="LT" value="4"/>
        </triggered_effect>
      </effect_group>

      <!-- Main effects -->
      <effect_group tiered="false">
        <passive_effect name="RunSpeed" operation="perc_add" value=".5"/>
        <passive_effect name="WalkSpeed" operation="perc_add" value=".5"/>
        <passive_effect name="CrouchSpeed" operation="perc_add" value=".5"/>
        <passive_effect name="AttacksPerMinute" operation="perc_add" value=".5"/>

        <!-- Dynamic jump strength based on stacks -->
        <passive_effect name="JumpStrength" operation="perc_add" value="@$parkourJumpBonus"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$parkourJumpBonus" operation="set" value="@$parkourJumpStacks"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$parkourJumpBonus" operation="multiply" value="2"/>

        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$parkourJumpBonus" operation="set" value="@$parkourJumpStacks"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$parkourJumpBonus" operation="multiply" value="2"/>

        <passive_effect name="StaminaLoss" operation="perc_add" value="-.75" tags="jumping"/>
        <!--<triggered_effect trigger="onSelfJump" action="PlaySound" sound="twitch_jump" play_in_head="false"/>-->
      </effect_group>

      <!-- Store original value and apply boost when buff starts -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$originalParkourBonus" operation="set" value="@$parkourBonus"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$parkourBonus" operation="multiply" value="1.5"/>
      </effect_group>

      <!-- Duration cap handling -->
      <effect_group>
        <!-- Check for duration cap on stack -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$buffParkourBoostDuration" operation="set" value="@$buffParkourBoostDurationMax">
          <requirement name="CVarCompare" cvar="$buffParkourBoostDuration" operation="GT" value="@$buffParkourBoostDurationMax"/>
        </triggered_effect>

        <!-- Standard duration management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffParkourBoostDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffParkourBoostDisplay" operation="set" value="@$buffParkourBoostDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffParkourBoostDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <!-- Reset all values when buff expires -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffParkourBoost">
          <requirement name="CVarCompare" cvar="$buffParkourBoostDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$parkourBonus" operation="set" value="@$originalParkourBonus"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffParkourBoostDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffParkourBoostDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$parkourJumpStacks" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$parkourJumpBonus" operation="set" value="0"/>
      </effect_group>
    </buff>

    <buff name="buffPumpkinClubBonus" name_key="buffPumpkinClubBonus" description_key="buffPumpkinClubBonusDesc" icon="ui_game_symbol_club" icon_color="255,128,0">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffPumpkinClubBonusDisplay"/>
      <display_value_format value="time"/>

      <!-- Duration management -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffPumpkinClubBonusDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffPumpkinClubBonusDisplay" operation="set" value="@$buffPumpkinClubBonusDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffPumpkinClubBonusDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <!-- Cleanup -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffPumpkinClubBonus">
          <requirement name="CVarCompare" cvar="$buffPumpkinClubBonusDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffPumpkinClubBonusDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffPumpkinClubBonusDuration" operation="set" value="0"/>
      </effect_group>

      <!-- Club damage effects -->
      <effect_group>
        <!-- Base club damage boost -->
        <passive_effect name="EntityDamage" operation="perc_add" value="0.5" tags="perkBrawler"/>

        <!-- Club attack speed boost -->
        <passive_effect name="AttacksPerMinute" operation="perc_add" value="0.2" tags="perkBrawler"/>

        <!-- Stun chance on hits -->
        <passive_effect name="BuffProcChance" operation="base_add" value="0.2" tags="buffInjuryStunned01CHTrigger"/>
      </effect_group>

      <!-- Bonus effect when hitting stunned enemies -->
      <effect_group>
        <requirement name="HoldingItemHasTags" tags="perkBrawler"/>
        <requirement name="HasBuff" target="other" buff="buffInjuryStunned01CHTrigger"/>
        <passive_effect name="EntityDamage" operation="perc_add" value="0.5"/>
      </effect_group>
    </buff>

    <buff name="buffBearStrength" name_key="buffBearStrength" description_key="buffBearStrengthDesc" icon="ui_game_symbol_muscle">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffBearStrengthDisplay"/>
      <display_value_format value="time"/>

      <!-- Sound effect -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bearattack" play_in_head="false"/>
        <triggered_effect trigger="onSelfKilledOther" action="PlaySound" sound="bearattack" play_in_head="false"/>
      </effect_group>

      <!-- Timer management -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffBearStrengthDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffBearStrengthDisplay" operation="set" value="@$buffBearStrengthDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffBearStrengthDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <!-- Cleanup and Fatigue Application -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffBearStrength">
          <requirement name="CVarCompare" cvar="$buffBearStrengthDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <!-- Apply fatigue when buff ends -->
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffFatigued"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffBearStrengthDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffBearStrengthDuration" operation="set" value="0"/>
      </effect_group>

      <!-- Bear-like effects -->
      <effect_group>
        <!-- Enhanced strength -->
        <passive_effect name="AttributeLevel" tags="attStrength" operation="base_add" value="2"/>
        <passive_effect name="AttributeLevel" tags="attFortitude" operation="base_add" value="1"/>
        <passive_effect name="AttributeLevel" tags="attIntelligence" operation="base_add" value="-2"/>

        <!-- Enhanced melee damage -->
        <passive_effect name="EntityDamage" operation="perc_add" value="0.75" tags="perkBrawler"/>

        <!-- Increased block damage to represent bear strength -->
        <passive_effect name="BlockDamage" operation="perc_add" value="0.5"/>

        <!-- Enhanced metabolism (Iron Gut) -->
        <passive_effect name="WaterLossPerHealthPointGained" operation="perc_add" value="-.25"/>
        <passive_effect name="WaterLossPerStaminaPointGained" operation="perc_add" value="-.25"/>
        <passive_effect name="FoodLossPerStaminaPointGained" operation="perc_add" value="-.25"/>

        <!-- Animal tracking -->
        <passive_effect name="TrackDistance" operation="base_set" level="0,1,5" value="0,100,100"/>
        <triggered_effect trigger="onSelfCrouch" action="AddBuff" buff="buffAnimalTracker"/>

        <!-- Enhanced stamina recovery on kills -->
        <triggered_effect trigger="onSelfKilledOther" action="ModifyStats" stat="Stamina" operation="add" value="50"/>

        <!-- Bear-like rage when health is low -->
        <passive_effect name="EntityDamage" operation="perc_add" value="0.25">
          <requirement name="StatComparePercCurrentToMax" stat="health" operation="LTE" value="0.3"/>
        </passive_effect>
      </effect_group>

      <!-- Intimidation effects -->
      <effect_group>
        <passive_effect name="BuffResistance" operation="base_add" value="0.3" tags="buffFatiguedTrigger,buffInjuryStunned01CHTrigger"/>
        <triggered_effect trigger="onOtherAttackedSelf" action="AddBuff" buff="buffInjuryStunned01CHTrigger" target="other">
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="15"/>
        </triggered_effect>
      </effect_group>
    </buff>

    <buff name="buffBulletproofCoffee" name_key="bulletproofCoffee" description_key="bulletproofCoffeeDesc" icon="ui_game_symbol_defense" icon_color="102,178,255">
      <stack_type value="ignore"/>
      <duration value="0"/>
      <display_value value=".buffBulletproofCoffeeDisplay"/>
      <display_value_format value="time"/>

      <!-- Duration management -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffBulletproofCoffeeDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffBulletproofCoffeeDisplay" operation="set" value="@$buffBulletproofCoffeeDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffBulletproofCoffeeDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <!-- Cleanup -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffBulletproofCoffee">
          <requirement name="CVarCompare" cvar="$buffBulletproofCoffeeDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffBulletproofCoffeeDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffBulletproofCoffeeDuration" operation="set" value="0"/>
      </effect_group>

      <!-- Main protective effects -->
      <effect_group>
        <!-- Core damage resistance -->
        <passive_effect name="PhysicalDamageResist" operation="base_add" value="0.6" tags="coredamageresist"/>

        <!-- Enhanced total damage resistance -->
        <passive_effect name="GeneralDamageResist" operation="base_add" value="0.4"/>

        <!-- Temperature resistance -->
        <passive_effect name="HypothermalResist" operation="base_add" value="75"/>
        <passive_effect name="HyperthermalResist" operation="base_add" value="75"/>

        <!-- Fall damage reduction - direct reduction to fall damage -->
        <passive_effect name="FallDamageReduction" operation="perc_add" value="-.25"/>

        <!-- Comprehensive injury and status effect resistance -->
        <passive_effect name="BuffResistance" operation="base_add" value="0.65"
                        tags="buffInjuryStunned01CHTrigger,buffInjuryBleedingTwo,buffLaceration,buffInfectionCatch,buffAbrasionCatch,buffFatiguedTrigger,buffArmSprainedCHTrigger,buffLegSprainedCHTrigger,buffInjuryStunned01CHTrigger,buffInjuryBleedingBarbedWire,buffLegBroken,buffLegSprained"/>

        <!-- Additional fall trigger resistance -->
        <passive_effect name="BuffResistance" operation="base_add" value="0.75" tags="triggerBrokenLeg,triggerSprainedLeg"/>

        <!-- Carry bonus to represent MCT oil benefits -->
        <passive_effect name="CarryCapacity" operation="base_add" value="20"/>
      </effect_group>
    </buff>

    <buff name="buffLondonFogStealth" name_key="buffLondonFogStealth" description_key="buffLondonFogStealthDesc" icon="ui_game_symbol_stealth" icon_color="51,51,76">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffLondonFogStealthDisplay"/>
      <display_value_format value="time"/>

      <!-- Duration management -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffLondonFogStealthDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffLondonFogStealthDisplay" operation="set" value="@$buffLondonFogStealthDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffLondonFogStealthDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <!-- Cleanup -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffLondonFogStealth">
          <requirement name="CVarCompare" cvar="$buffLondonFogStealthDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffLondonFogStealthDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffLondonFogStealthDuration" operation="set" value="0"/>
      </effect_group>

      <!-- Stealth effects -->
      <effect_group>
        <!-- Base noise reduction -->
        <passive_effect name="NoiseMultiplier" operation="perc_subtract" value="0.5"/>
        <passive_effect name="LightMultiplier" operation="perc_subtract" value="0.3"/>

        <!-- Silent movement on certain materials -->
        <passive_effect name="SilenceBlockSteps" operation="base_set" value="1" tags="earth,grass,snow,sand"/>

        <!-- Movement speed while sneaking -->
        <passive_effect name="CrouchSpeed" operation="perc_add" value="0.3"/>
      </effect_group>

      <!-- Sneak attack bonus -->
      <effect_group>
        <requirement name="CVarCompare" cvar="_crouching" operation="Equals" value="1"/>
        <requirement name="CVarCompare" cvar="_notAlerted" operation="GT" value="0" target="other"/>
        <passive_effect name="DamageBonus" operation="base_add" value="1.5"/> <!--For UI-->
        <passive_effect name="EntityDamage" operation="perc_add" value="1.5"/>
      </effect_group>
    </buff>

    <buff name="buffDragonsBreath" name_key="buffDragonsBreath" description_key="buffDragonsBreathDesc" icon="ui_game_symbol_fire" icon_color="255,0,0">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffDragonsBreathDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="debuffDehydrate"/>
        <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="FireMediumLoop" play_in_head="false"/>
        <triggered_effect trigger="onSelfBuffStack" action="PlaySound" sound="FireMediumLoop" play_in_head="false"/>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDragonsBreathDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffDragonsBreathDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffDragonsBreathDisplay" operation="set" value="@$buffDragonsBreathDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffDragonsBreathDisplay" operation="divide" value="@$MetabolismDuration"/>

        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffBurningElementDuration" operation="set" value="@$buffDragonsBreathDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffBurningElementDuration" operation="set" value="@$buffDragonsBreathDuration"/>
      </effect_group>

      <effect_group>
        <!-- Buff removal and cleanup -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffDragonsBreath">
          <requirement name="CVarCompare" cvar="$buffDragonsBreathDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffDragonsBreathDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffDragonsBreathDuration" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Visual and sound effects -->
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffBurningElement"/>
        <triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="buffBurningElement"/>

      </effect_group>

      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" target="selfAOE" range="5" buff="buffRingOfFireEffect">
          <requirement name="!EntityTagCompare" target="other" tags="npc,vehicle,player,turret,drone"/>
        </triggered_effect>

        <passive_effect name="HypothermalResist" operation="base_add" value="100"/>
        <passive_effect name="HyperthermalResist" operation="base_add" value="100"/>
        <passive_effect name="ElementalDamageResist" operation="base_add" value="20000" tags="heat"/>
        <passive_effect name="EntityDamage" operation="perc_add" value=".99" tags="perkGunslinger,perkBoomstick,perkDeadEye,perkMachineGunner,perkBookAutoWeapons,perkArchery,admin"/>

        <!-- Counter buffBurningElement effects -->
        <passive_effect name="HealthChangeOT" operation="base_add" value="1.5"/>
        <passive_effect name="WaterChangeOT" operation="base_add" value="2"/>
      </effect_group>
    </buff>

    <buff name="buffApexPeak" name_key="buffApexPeak" description_key="buffApexPeakDesc" icon="ui_game_symbol_perk" icon_color="132,0,155">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffApexPeakDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="debuffDehydrate"/>
        <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="levelupplayer" play_in_head="false"/>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffApexPeakDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffApexPeakDisplay" operation="set" value="@$buffApexPeakDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffApexPeakDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <!-- Max out attributes -->
        <passive_effect name="AttributeLevel" tags="attStrength,attFortitude,attAgility,attPerception,attIntellect" operation="base_add" value="3"/>
        <passive_effect name="PerkLevel" operation="base_set" value="5"/>

        <!-- Buff removal -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffApexPeak">
          <requirement name="CVarCompare" cvar="$buffApexPeakDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffApexCrash"/>
      </effect_group>

      <!-- Cleanup -->
      <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffApexPeakDuration" operation="set" value="0"/>
    </buff>

    <buff name="buffApexCrash" name_key="buffApexCrash" description_key="buffApexCrashDesc" icon="ui_game_symbol_fatigued" icon_color="127,187,34">
      <stack_type value="replace"/>
      <duration value="300"/>
      <display_value value=".buffApexCrashDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="debuffDehydrate"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".buffApexCrashDisplay" operation="set" value="300"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffApexCrashDisplay" operation="subtract" value="1"/>

        <!-- Minimum attributes during crash -->
        <passive_effect name="AttributeLevel" tags="attStrength,attFortitude,attAgility,attPerception,attIntellect" operation="base_add" value="-1"/>
        <passive_effect name="PerkLevel" operation="base_set" value="0"/>
      </effect_group>
    </buff>

    <buff name="buffPhoenixFire" name_key="buffPhoenixFire" tooltip_key="buffPhoenixFireTooltip" description_key="buffPhoenixFireDesc" icon="ui_game_symbol_fire" icon_color="255,165,0">
      <stack_type value="ignore"/>
      <display_value_key value="buffPhoenixFireNameShortSpace"/>
      <display_value value="xxx"/>

      <effect_group name="Initial Fire Phase">
        <!-- Start the burning effect -->
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffBurningElement"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".phoenixFirePhase" operation="set" value="0"/>

        <!-- Track time for first phase -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".phoenixFirePhase" operation="add" value="1"/>
      </effect_group>

      <effect_group name="Transition to Rebirth">
        <!-- After 10 seconds, remove burning and trigger rebirth -->

        <!-- Clear ALL Effects -> you are starting out clean as a whistle again -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffBurningElement">
          <requirement name="CVarCompare" cvar=".phoenixFirePhase" operation="GTE" value="10"/>
        </triggered_effect>

        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffPhoenixRebirth">
          <requirement name="CVarCompare" cvar=".phoenixFirePhase" operation="GTE" value="10"/>
          <requirement name="HasBuff" buff="buffBurningElement"/>
        </triggered_effect>

        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="debuffDehydrate"/>

        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffPhoenixFire">
          <requirement name="CVarCompare" cvar=".phoenixFirePhase" operation="GTE" value="11"/>
        </triggered_effect>
      </effect_group>

      <effect_group name="Cleanup">
        <!-- Ensure everything is cleaned up when the buff ends -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".phoenixFirePhase" operation="set" value="0"/>
      </effect_group>

      <!-- Safety cleanup -->
      <effect_group>
        <triggered_effect trigger="onSelfDied" action="RemoveBuff" buff="buffPhoenixFire"/>
        <triggered_effect trigger="onSelfLeaveGame" action="RemoveBuff" buff="buffPhoenixFire"/>
      </effect_group>
    </buff>

    <buff name="buffPhoenixRebirth" name_key="buffPhoenixRebirth" tooltip_key="buffPhoenixRebirthTooltip" description_key="buffPhoenixRebirthDesc" icon="ui_game_symbol_fire" icon_color="0,255,0">
      <stack_type value="ignore"/>
      <display_value_key value="buffPhoenixFireNameShortSpace"/>
      <display_value value="xxx"/>

      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="RemoveAllNegativeBuffs"/>

        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="Health" operation="set" value="25000"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="Food" operation="set" value="25000"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="Water" operation="set" value="25000"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="Stamina" operation="set" value="25000"/>

        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$armHurtCounter" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$legHurtCounter" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="healAbrasionMult" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="medicalRegHealthAmount" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="foodHealthAmount" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$abrasionHealthMaxBlockage" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$abrasionCounter" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugPainkillersDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugVitaminsDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugVitaminsDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugPainkillersDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugSteroidsDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugRecogDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugFortBitesDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugAtomJunkiesDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugCovertCatsDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugEyeKandyDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugHackersDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugHealthBarDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugJailBreakersDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugNerdTatsDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugOhShitzDropsDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugRockBustersDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugSkullCrushersDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugSugarButtsDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffShamChowderDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffPumpkinCheesecakeDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffRedTeaDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffRedTeaDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffYuccaJuiceSmoothieDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffMegaCrushDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffCoffeeDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffCoffeeBSDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffBeerDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffGrandpasMoonshineDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffGrandpasAwesomeSauceDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffGrandpasLearningElixirDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$foodAmountAdd" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$waterAmountAdd" operation="set" value="0"/>

        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffColdResistDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffHeatResistDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffParkourBoostDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffBearStrengthDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffPumpkinClubBonusDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffBulletproofCoffeeDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffLondonFogStealthDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDragonsBreathDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffApexPeakDuration" operation="set" value="0"/>

        <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffFoodStaminaBonus"/>
        <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="debuffCursed"/>
        <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffTooMuchCaffeine"/>
        <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffDragonsBreath"/>
        <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffApexCrash"/>
        <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffPhoenixRebirth"/>
        <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffPhoenixFire"/>
        <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="debuffDehydrate"/>
      </effect_group>

      <!-- Safety cleanup -->
      <effect_group>
        <triggered_effect trigger="onSelfLeaveGame" action="RemoveBuff" buff="buffPhoenixRebirth"/>
        <triggered_effect trigger="onSelfDied" action="RemoveBuff" buff="buffPhoenixRebirth"/>
      </effect_group>
    </buff>

    <buff name="buffGrandpasLegacy" name_key="buffGrandpasPower" description_key="buffGrandpasPowerDesc" icon="ui_game_symbol_radiation" icon_color="0,190,0">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffGrandpasLegacyDisplay"/>
      <display_value_format value="time"/>

      <effect_group name="buffs">

        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveAllNegativeBuffs"/>

        <!-- Massive power boost -->
        <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="a_radiated_kill_lp" play_in_head="false"/>

        <!-- Damage resistance -->
        <passive_effect name="GeneralDamageResist" operation="base_set" value="500"/>
        <passive_effect name="ElementalDamageResist" operation="base_set" value="500" tags="cold,heat,electrical,radiation,toxic"/>
        <passive_effect name="PhysicalDamageResist" operation="base_set" value="500" tags="coredamageresist"/>
        <passive_effect name="PhysicalDamageResist" operation="base_set" value="500"/>

        <passive_effect name="PlayerExpGain" operation="perc_add" value="1.0"/>
        <passive_effect name="StaminaChangeOT" operation="perc_add" value="1.0"/>
        <passive_effect name="BuffResistance" operation="base_add" value="10" tags="buffInjuryStunned01CHTrigger,buffInjuryStunned00,buffInjuryStunned01,buffInjuryStunned01Shotgun,buffInjuryStunned02,buffInjuryStunned02Shotgun,buffInjuryStunned03,buffInjuryStunned03Shotgun"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Health" operation="set" value="200"/>
      </effect_group>

      <effect_group name="buff_timers">
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffGrandpasLegacyDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffGrandpasLegacyDisplay" operation="set" value="@$buffGrandpasLegacyDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffGrandpasLegacyDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group name="effects">
        <!-- Visual and particle effects -->
        <triggered_effect trigger="onSelfBuffStart" action="AttachParticleEffectToEntity" particle="RadiatedParticlesOnMesh" local_offset="0,0,0" shape_mesh="true"/> <!--parent_transform="LOD0" shape_mesh="true"/>-->
        <triggered_effect trigger="onSelfBuffRemove" action="RemoveParticleEffectFromEntity" particle="RadiatedParticlesOnMesh"/>
        <triggered_effect trigger="onSelfDied" action="RemoveParticleEffectFromEntity" particle="RadiatedParticlesOnMesh"/>

        <!-- Screen effects -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="4" effect_name="Drunk"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" effect_name="Drunk"/>
      </effect_group>

      <effect_group name="other_effects">
        <!-- Infection aura -->
        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" target="selfAOE" range="1" buff="buffGrandpasInfection">
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="100"/>
        </triggered_effect>

        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" target="selfAOE" range="3" buff="buffGrandpasInfection">
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="50"/>
        </triggered_effect>

        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" target="selfAOE" range="6" buff="buffGrandpasInfection">
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="10"/>
        </triggered_effect>

      </effect_group>

      <!-- When power ends, apply permanent effects -->
      <effect_group name="debuffs">
        <triggered_effect trigger="onSelfBuffRemove" action="PlaySound" sound="player1sick" play_in_head="false"/>

        <triggered_effect trigger="onSelfBuffRemove" action="ModifyStats" stat="Food" operation="set" value="10"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyStats" stat="Water" operation="set" value="10"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyStats" stat="Stamina" operation="set" value="0"/>

        <!-- Permanent injuries -->
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="triggerAbrasion"/>
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="triggerBrokenLeg"/>
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="triggerBrokenArm"/>
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="triggerFatigued"/>
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="triggerLaceration"/>
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="triggerConcussion"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="infectionCounter" operation="set" value="22680"/>
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffInfectionMain"/>

      </effect_group>

      <!-- Safety cleanup -->
      <effect_group name="cleanup">
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGrandpasLegacy">
          <requirement name="CVarCompare" cvar="$buffGrandpasLegacyDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffGrandpasLegacyDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffGrandpasLegacyDuration" operation="set" value="0"/>

        <triggered_effect trigger="onSelfLeaveGame" action="RemoveBuff" buff="buffGrandpasLegacy"/>
        <triggered_effect trigger="onSelfDied" action="RemoveBuff" buff="buffGrandpasLegacy"/>
      </effect_group>
    </buff>

    <!-- Infection Spread Effect -->
    <buff name="buffGrandpasInfection" name_key="buffGrandpasInfection" icon="ui_game_symbol_infection" icon_color="128,0,0">
      <stack_type value="ignore"/>
      <duration value="1"/>
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffInfectionMain">
          <requirement name="!HasBuff" target="other" buff="buffInfectionMain"/>
        </triggered_effect>
      </effect_group>
    </buff>

  </append>

</hurgleburgler>