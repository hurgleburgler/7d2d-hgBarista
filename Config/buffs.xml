<hurgleburgler>

  <append xpath="/buffs/buff[@name='god']/effect_group">
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="debuffCursed"/>
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffTooMuchCaffeine"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffColdResistDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffHeatResistDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffParkourBoostDuration" operation="set" value="0"/>
    <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffBearStrengthDuration" operation="set" value="0"/>
  </append>

  <insertAfter xpath="/buffs/buff[@name='buffBlackStrapCoffee']/effect_group/triggered_effect[@action='RemoveBuff' and @buff='buffCoffee']">
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffCaffeine"/>
  </insertAfter>

  <insertAfter xpath="/buffs/buff[@name='buffCoffee']/effect_group/triggered_effect[@action='RemoveBuff' and @buff='buffBlackStrapCoffee']">
    <triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="buffCaffeine"/>
  </insertAfter>

  <append xpath="/buffs">

    <buff name="debuffCursed" name_key="debuffCursedCoffee" description_key="debuffCursedCoffeeDesc" icon="ui_game_symbol_skull" icon_color="0,255,0" icon_blink="true">
      <stack_type value="ignore"/>

      <effect_group tiered="false">
        <!-- Apply stat penalties -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="Health" operation="add" value="@$debuffCursedHealthPenalty"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="water" operation="add" value="@$debuffCursedWaterPenalty"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="stamina" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="food" operation="add" value="@$debuffCursedFoodPenalty"/>
        <passive_effect name="StaminaChangeOT" operation="base_set" value="@$debuffCursedStaminaRegen"/>
      </effect_group>

      <effect_group>
        <!-- Clean up -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$debuffCursedHealthPenalty" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$debuffCursedWaterPenalty" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$debuffCursedFoodPenalty" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$debuffCursedStaminaRegen" operation="set" value="0"/>
      </effect_group>
    </buff>

    <buff name="debuffTooMuchCaffeine" name_key="buffTooMuchCaffeineName" description_key="debuffTooMuchCaffeineDesc" icon="ui_game_symbol_food_poisoning" icon_color="255,0,0" icon_blink="true">
      <damage_type value="Dehydration"/>
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".debuffTooMuchCaffeineDisplay"/>
      <display_value_format value="time"/>

      <!-- Duration Setup -->
      <effect_group>

        <!-- Initial setup only -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$tooMuchCaffeineStackDuration" operation="set" value="@$debuffTooMuchCaffeineDuration"/>

        <!-- Will be called for subsequent stacks -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$tooMuchCaffeineStackDuration" operation="add" value="@$debuffTooMuchCaffeineDuration"/>


        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$tooMuchCaffeineStackDuration" operation="subtract" value="1"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".debuffTooMuchCaffeineDisplay" operation="set" value="@$tooMuchCaffeineStackDuration"/>

        <!-- Remove buff when duration expires -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="debuffTooMuchCaffeine">
          <requirement name="CVarCompare" cvar="$tooMuchCaffeineStackDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Clean up variables -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".debuffTooMuchCaffeineDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$debuffTooMuchCaffeineDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$tooMuchCaffeineStackDuration" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Visual effects -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="1" effect_name="Distortion"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="1" effect_name="Distortion"/>

        <!-- Sound effect -->
        <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="Player$Thirsty" play_in_head="true"/>

        <!-- Apply dehydration debuff -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="dehydrateAmount" operation="set" value="50"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="dehydrateOverTime" operation="set" value="10"/>
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="debuffDehydrate"/>

        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="dehydrateAmount" operation="set" value="50"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="dehydrateOverTime" operation="set" value="10"/>
        <triggered_effect trigger="onSelfBuffStack" action="AddBuff" buff="debuffDehydrate"/>

        <!-- Fatigue after effect -->
        <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffCaffeineFatigue"/>

      </effect_group>
    </buff>

    <buff name="buffCaffeineFatigue" name_key="buffFatiguedName" description_key="buffFatiguedDesc" icon="ui_game_symbol_fatigued" icon_color="255,128,0">
      <damage_type value="Disease"/>
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".fatiguedDurationDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Duration setup -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$fatiguedCounter" operation="set" value="7208"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$fatiguedCounter" operation="set" value="7208"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$fatiguedCounter" operation="subtract" value="@$critHitNaturalHealingRate"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fatiguedDurationDisplay" operation="set" value="@$fatiguedCounter"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fatiguedDurationDisplay" operation="divide" value="@$critHitNaturalHealingRate"/>

        <!-- Remove when done -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffCaffeineFatigue">
          <requirement name="CVarCompare" cvar="$fatiguedCounter" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Cleanup -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$fatiguedCounter" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".fatiguedDurationDisplay" operation="set" value="0"/>
      </effect_group>

      <!-- Core fatigue effects without infection vector -->
      <effect_group>
        <passive_effect name="BuffBlink" operation="base_set" value="2" duration="0,3" tags="buffCaffeineFatigue"/>
        <passive_effect name="HealthLoss" operation="perc_add" value=".1"/>
      </effect_group>
    </buff>

    <buff name="debuffDehydrate" name_key="buffDehydrateName" description_key="buffDehydrateDesc" icon="ui_game_symbol_thirst" icon_color="255,0,0" icon_blink="true">
      <damage_type value="Dehydration"/>
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".dehydrateDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Initial setup -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$dehydratePointsRemaining" operation="set" value="@dehydrateAmount"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$dehydrateTimeRemaining" operation="set" value="@dehydrateDuration"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$dehydratePerSecond" operation="set" value="@dehydrateAmount"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$dehydratePerSecond" operation="divide" value="@dehydrateDuration"/>

        <!-- Stack handling -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$dehydratePointsRemaining" operation="add" value="@dehydrateAmount"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$dehydrateTimeRemaining" operation="add" value="@dehydrateDuration"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$dehydratePerSecond" operation="set" value="@$dehydratePointsRemaining"/>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$dehydratePerSecond" operation="divide" value="@$dehydrateTimeRemaining"/>

        <!-- Per tick updates -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="water" operation="subtract" value="@$dehydratePerSecond"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$dehydratePointsRemaining" operation="subtract" value="@$dehydratePerSecond"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$dehydrateTimeRemaining" operation="subtract" value="1"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".dehydrateDisplay" operation="set" value="@$dehydrateTimeRemaining"/>
      </effect_group>

      <effect_group>
        <!-- End buff when duration expires -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="debuffDehydrate">
          <requirement name="CVarCompare" cvar="$dehydrateTimeRemaining" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Cleanup -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$dehydrateTimeRemaining" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$dehydratePointsRemaining" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$dehydratePerSecond" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".dehydrateDisplay" operation="set" value="0"/>
      </effect_group>
    </buff>

    <buff name="buffCaffeine" name_key="drinkJarCoffee" description_key="drinkJarCoffeeDesc" icon="ui_game_symbol_coffee">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffCaffeineDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Increment counter on new stack -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$coffeeConsumedCount" operation="add" value="1"/>

        <!-- Check for too much coffee -->
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffTooMuchCaffeine">
          <requirement name="CVarCompare" cvar="$coffeeConsumedCount" operation="GTE" value="10"/>
        </triggered_effect>

        <!-- Duration cap check -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="set" value="@$buffCaffeineDurationMax">
          <requirement name="CVarCompare" cvar="$buffCaffeineDuration" operation="GT" value="@$buffCaffeineDurationMax"/>
        </triggered_effect>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffCaffeineDisplay" operation="set" value="@$buffCaffeineDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffCaffeineDisplay" operation="divide" value="@$MetabolismDuration"/>

        <!-- Apply dehydration on start -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="dehydrateAmount" operation="set" value="@$buffCaffeineDehydration"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="dehydrateDuration" operation="set" value="60"/>
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="debuffDehydrate"/>

        <!-- Apply dehydration on stack -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="dehydrateAmount" operation="set" value="@$buffCaffeineDehydration"/>
         <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="dehydrateDuration" operation="set" value="60"/>
        <triggered_effect trigger="onSelfBuffStack" action="AddBuff" buff="debuffDehydrate"/>
      </effect_group>

      <effect_group>
        <!-- Buff removal and cleanup -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffCaffeine">
          <requirement name="CVarCompare" cvar="$buffCaffeineDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Reset counter when buff expires -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$coffeeConsumedCount" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffCaffeineDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffCaffeineDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffCaffeineStaminaRegen" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffCaffeineDehydration" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Stamina effects with water healing consideration -->
        <passive_effect name="StaminaChangeOT" operation="perc_add" value="@$buffCaffeineStaminaRegen">
          <requirement name="!HasBuff" buff="buffHealWaterMax"/>
        </passive_effect>

        <passive_effect name="StaminaChangeOT" operation="perc_add" value="0.1">
          <requirement name="HasBuff" buff="buffHealWaterMax"/>
        </passive_effect>

        <!-- Base dehydration effect -->
        <passive_effect name="WaterLossPerStaminaPointGained" operation="perc_add" value="@$buffCaffeineDehydration"/>
      </effect_group>
    </buff>

    <buff name="buffColdResist" name_key="buffColdResist" description_key="buffColdResistDesc" icon="ui_game_symbol_cold" icon_color="0,102,204">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffColdResistDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Duration cap check -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$buffColdResistDuration" operation="set" value="@$buffColdResistDurationMax">
          <requirement name="CVarCompare" cvar="$buffColdResistDuration" operation="GT" value="@$buffColdResistDurationMax"/>
        </triggered_effect>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffColdResistDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffColdResistDisplay" operation="set" value="@$buffColdResistDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffColdResistDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <!-- Remove buff when duration expires -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffColdResist">
          <requirement name="CVarCompare" cvar="$buffColdResistDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Clean up variables -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffColdResistDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffColdResistDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffColdResistValue" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Apply the cold resistance effect -->
        <passive_effect name="HypothermalResist" operation="base_add" value="@$buffColdResistValue"/>
        <passive_effect name="HyperthermalResist" operation="base_subtract" value="10"/>
      </effect_group>
    </buff>

    <buff name="buffHeatResist" name_key="buffHeatResist" description_key="buffHeatResistDesc" icon="ui_game_symbol_hot" icon_color="204,102,0">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffHeatResistDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Duration cap check -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$buffHeatResistDuration" operation="set" value="@$buffHeatResistDurationMax">
          <requirement name="CVarCompare" cvar="$buffHeatResistDuration" operation="GT" value="@$buffHeatResistDurationMax"/>
        </triggered_effect>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffHeatResistDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffHeatResistDisplay" operation="set" value="@$buffHeatResistDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffHeatResistDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <!-- Remove buff when duration expires -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffHeatResist">
          <requirement name="CVarCompare" cvar="$buffHeatResistDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Clean up variables -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffHeatResistDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffHeatResistDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffHeatResistValue" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Apply the heat resistance effect -->
        <passive_effect name="HyperthermalResist" operation="base_add" value="@$buffHeatResistValue"/>
        <passive_effect name="HypothermalResist" operation="base_subtract" value="10"/>
      </effect_group>
    </buff>

    <buff name="buffDiseaseResist" name_key="buffDiseaseResist" description_key="buffDiseaseResistDesc" icon="ui_game_symbol_natural_healing" icon_color="0,153,76">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffDiseaseResistDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffDiseaseResistDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffDiseaseResistDisplay" operation="set" value="@$buffDiseaseResistDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffDiseaseResistDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$buffDiseaseResistDuration" operation="set" value="@$buffDiseaseResistDurationMax">
          <requirement name="CVarCompare" cvar="$buffDiseaseResistDuration" operation="GT" value="@$buffDiseaseResistDurationMax"/>
        </triggered_effect>

        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffDiseaseResist">
          <requirement name="CVarCompare" cvar="$buffDiseaseResistDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffDiseaseResistDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffDiseaseResistDuration" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <passive_effect name="BuffResistance" operation="base_add" value="@$buffDiseaseResistValue" tags="buffInfectionCatch,buffDysenteryCatchFood,buffDysenteryCatchDrink"/>
      </effect_group>
    </buff>

    <buff name="buffStaminaEfficiency" name_key="buffStaminaEfficiency" description_key="buffStaminaEfficiencyDesc" icon="ui_game_symbol_stamina" icon_color="0,153,153">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffStaminaEfficiencyDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <!-- Duration cap check -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$buffStaminaEfficiencyDuration" operation="set" value="@$buffStaminaEfficiencyDurationMax">
          <requirement name="CVarCompare" cvar="$buffStaminaEfficiencyDuration" operation="GT" value="@$buffStaminaEfficiencyDurationMax"/>
        </triggered_effect>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffStaminaEfficiencyDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffStaminaEfficiencyDisplay" operation="set" value="@$buffStaminaEfficiencyDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffStaminaEfficiencyDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <!-- Remove buff when duration expires -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffStaminaEfficiency">
          <requirement name="CVarCompare" cvar="$buffStaminaEfficiencyDuration" operation="LTE" value="0"/>
        </triggered_effect>

        <!-- Clean up variables -->
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffStaminaEfficiencyDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffStaminaEfficiencyDuration" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffStaminaEfficiencyValue" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Apply stamina efficiency effects -->
        <passive_effect name="FoodLossPerStaminaPointGained" operation="perc_add" value="@$buffStaminaEfficiencyValue"/>
        <passive_effect name="WaterLossPerStaminaPointGained" operation="perc_add" value="@$buffStaminaEfficiencyValue"/>
      </effect_group>
    </buff>

    <buff name="buffParkourBoost" name_key="buffParkourBoost" description_key="buffParkourBoostDesc" icon="ui_game_symbol_parkour" icon_color="102,0,204">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffParkourBoostDisplay"/>
      <display_value_format value="time"/>

      <effect_group tiered="false">
        <passive_effect name="RunSpeed" operation="perc_add" value=".5"/>
        <passive_effect name="WalkSpeed" operation="perc_add" value=".5"/>
        <passive_effect name="CrouchSpeed" operation="perc_add" value=".5"/>
        <passive_effect name="AttacksPerMinute" operation="perc_add" value=".5"/>

        <passive_effect name="JumpStrength" operation="perc_add" value="1"/>
        <passive_effect name="StaminaLoss" operation="perc_add" value="-.75" tags="jumping"/>

        <triggered_effect trigger="onSelfJump" action="PlaySound" sound="twitch_jump" play_in_head="false"/>
        <triggered_effect trigger="onSelfJump" action="AddBuff" buff="buffRocketBootsAirborne"/>
      </effect_group>

      <!-- Store original value and apply boost when buff starts -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$originalParkourBonus" operation="set" value="@$parkourBonus"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$parkourBonus" operation="multiply" value="1.1"/>
      </effect_group>

      <!-- Duration cap handling -->
      <effect_group>

        <!-- Check for duration cap on stack -->
        <triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$buffParkourBoostDuration" operation="set" value="@$buffParkourBoostDurationMax">
          <requirement name="CVarCompare" cvar="$buffParkourBoostDuration" operation="GT" value="@$buffParkourBoostDurationMax"/>
        </triggered_effect>

        <!-- Standard duration management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffParkourBoostDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffParkourBoostDisplay" operation="set" value="@$buffParkourBoostDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffParkourBoostDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <!-- Reset parkour bonus to original value when buff expires -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffParkourBoost">
          <requirement name="CVarCompare" cvar="$buffParkourBoostDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$parkourBonus" operation="set" value="@$originalParkourBonus"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffParkourBoostDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffParkourBoostDuration" operation="set" value="0"/>
      </effect_group>
    </buff>

    <buff name="buffPumpkinClubBonus" name_key="buffPumpkinClubBonus" description_key="buffPumpkinClubBonusDesc" icon="ui_game_symbol_club" icon_color="255,128,0">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffPumpkinClubBonusDisplay"/>
      <display_value_format value="time"/>

      <!-- Club damage boost -->
      <effect_group>
        <passive_effect name="EntityDamage" operation="perc_add" value="1" tags="perkPummelPete"/>
      </effect_group>

      <!-- Standard buff duration management -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffPumpkinClubBonusDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffPumpkinClubBonusDisplay" operation="set" value="@$buffPumpkinClubBonusDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffPumpkinClubBonusDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <!-- Remove buff when duration expires -->
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffPumpkinClubBonus">
          <requirement name="CVarCompare" cvar="$buffPumpkinClubBonusDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffPumpkinClubBonusDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffPumpkinClubBonusDuration" operation="set" value="0"/>
      </effect_group>
    </buff>

    <buff name="buffBearStrength" name_key="buffBearStrength" description_key="buffBearStrengthDesc" icon="ui_game_symbol_muscle"> <!-- icon_color="111,78,55">-->
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffBearStrengthDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bearattack" play_in_head="false"/>

        <!-- Timer management -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffBearStrengthDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffBearStrengthDisplay" operation="set" value="@$buffBearStrengthDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffBearStrengthDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <!-- Buff removal -->
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffBearStrength">
          <requirement name="CVarCompare" cvar="$buffBearStrengthDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffBearStrengthDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffBearStrengthDuration" operation="set" value="0"/>
      </effect_group>

      <effect_group>
        <!-- Strength effects -->
        <passive_effect name="AttributeLevel" tags="attStrength" operation="base_add" value="2"/>
        <passive_effect name="EntityDamage" operation="perc_add" value="0.5" tags="perkBrawler"/>

        <!-- Iron Gut -->
        <passive_effect name="WaterLossPerHealthPointGained" operation="perc_add" value="-.25"/>
        <passive_effect name="WaterLossPerStaminaPointGained" operation="perc_add" value="-.25"/>
        <passive_effect name="FoodLossPerStaminaPointGained" operation="perc_add" value="-.25"/>

        <!-- buffAnimalTracker -->
        <passive_effect name="TrackDistance" operation="base_set" level="0,1,5" value="0,100,100"/>
        <triggered_effect trigger="onSelfCrouch" action="AddBuff" buff="buffAnimalTracker"/>

        <!-- Sexual Tyrannosaurus -->
        <triggered_effect trigger="onSelfKilledOther" action="ModifyStats" stat="Stamina" operation="add" value="30"/>

      </effect_group>
    </buff>

    <!-- Bulletproof Coffee Buff -->
    <buff name="buffBulletproofCoffee" name_key="bulletproofCoffee" description_key="bulletproofCoffeeDesc" icon="ui_game_symbol_armor">
      <stack_type value="replace"/>
      <duration value="0"/>
      <display_value value=".buffBulletproofCoffeeDisplay"/>
      <display_value_format value="time"/>

      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffBulletproofCoffeeDuration" operation="subtract" value="@$MetabolismDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffBulletproofCoffeeDisplay" operation="set" value="@$buffBulletproofCoffeeDuration"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffBulletproofCoffeeDisplay" operation="divide" value="@$MetabolismDuration"/>
      </effect_group>

      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffBulletproofCoffee">
          <requirement name="CVarCompare" cvar="$buffBulletproofCoffeeDuration" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffBulletproofCoffeeDisplay" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffBulletproofCoffeeDuration" operation="set" value="0"/>
      </effect_group>

      <effect_group>

        <!-- Fort Bites-style defense (doubled) -->
        <passive_effect name="GeneralDamageResist" operation="base_add" value="1.0"/>
        <passive_effect name="WaterChangeOT" operation="base_subtract" value=".5"/>
        <passive_effect name="BuffResistance" operation="base_add" value="1"/>

      </effect_group>
    </buff>

    <!--

        <buff name="buffLondonFogStealth" name_key="buffLondonFogStealth" description_key="buffLondonFogStealthDesc" icon="ui_game_symbol_stealth">
          <stack_type value="replace"/>
          <duration value="0"/>
          <display_value value=".buffLondonFogStealthDisplay"/>
          <display_value_format value="time"/>

          <effect_group>
            &lt;!&ndash; Timer management &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffLondonFogStealthDuration" operation="subtract" value="@$MetabolismDuration"/>
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffLondonFogStealthDisplay" operation="set" value="@$buffLondonFogStealthDuration"/>
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffLondonFogStealthDisplay" operation="divide" value="@$MetabolismDuration"/>
          </effect_group>

          <effect_group>
            &lt;!&ndash; Buff removal &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffLondonFogStealth">
              <requirement name="CVarCompare" cvar="$buffLondonFogStealthDuration" operation="LTE" value="0"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffLondonFogStealthDisplay" operation="set" value="0"/>
            <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffLondonFogStealthDuration" operation="set" value="0"/>
          </effect_group>

          <effect_group>
            &lt;!&ndash; Enhanced stealth effects &ndash;&gt;
            <requirement name="CVarCompare" cvar="_crouching" operation="Equals" value="1"/>
            <requirement name="CVarCompare" cvar="_notAlerted" operation="GT" value="0" target="other"/>
            <passive_effect name="DamageBonus" operation="base_add" value="1.0"/> &lt;!&ndash;For UI&ndash;&gt;
            <passive_effect name="EntityDamage" operation="perc_add" value="1.0"/>
          </effect_group>
        </buff>

        <buff name="buffFireBreathing" name_key="buffFireBreathing" description_key="buffFireBreathingDesc" icon="ui_game_symbol_fire" icon_color="255,128,0">
          <stack_type value="replace"/>
          <duration value="0"/>
          <display_value value=".buffFireBreathingDisplay"/>
          <display_value_format value="time"/>

          <effect_group>
            &lt;!&ndash; Timer management &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffFireBreathingDuration" operation="subtract" value="@$MetabolismDuration"/>
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffFireBreathingDisplay" operation="set" value="@$buffFireBreathingDuration"/>
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffFireBreathingDisplay" operation="divide" value="@$MetabolismDuration"/>
          </effect_group>

          <effect_group>
            &lt;!&ndash; Buff removal and cleanup &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffFireBreathing">
              <requirement name="CVarCompare" cvar="$buffFireBreathingDuration" operation="LTE" value="0"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".buffFireBreathingDisplay" operation="set" value="0"/>
            <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$buffFireBreathingDuration" operation="set" value="0"/>
            <triggered_effect trigger="onSelfBuffRemove" action="RemoveParticleEffectFromEntity" particle="p_onFire"/>
          </effect_group>

          <effect_group>
            &lt;!&ndash; Visual and sound effects &ndash;&gt;
            <triggered_effect trigger="onSelfBuffStart" action="AttachParticleEffectToEntity" particle="p_onFire"/>
            <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="FireMediumLoop" play_in_head="true"/>
            <triggered_effect trigger="onSelfBuffRemove" action="FadeOutSound" sound="FireMediumLoop" play_in_head="true"/>

            &lt;!&ndash; Auto extinguish &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffExtinguishFire">
              <requirement name="HasBuff" buff="buffIsOnFire"/>
            </triggered_effect>
          </effect_group>
        </buff>

        <buff name="buffApexPeak" name_key="buffApexPeak" description_key="buffApexPeakDesc" icon="ui_game_symbol_perk" icon_color="132,0,155">
          <stack_type value="replace"/>
          <duration value="0"/>
          <display_value value=".buffApexPeakDisplay"/>
          <display_value_format value="time"/>

          <effect_group>
            &lt;!&ndash; Timer management &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffApexPeakDuration" operation="subtract" value="@$MetabolismDuration"/>
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffApexPeakDisplay" operation="set" value="@$buffApexPeakDuration"/>
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffApexPeakDisplay" operation="divide" value="@$MetabolismDuration"/>
          </effect_group>

          <effect_group>
            &lt;!&ndash; Max out attributes &ndash;&gt;
            <passive_effect name="AttributeLevel" tags="attStrength,attFortitude,attAgility,attPerception,attIntelligence" operation="base_add" value="10"/>
            <passive_effect name="PerkLevel" operation="base_set" value="5"/>

            &lt;!&ndash; Buff removal &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffApexPeak">
              <requirement name="CVarCompare" cvar="$buffApexPeakDuration" operation="LTE" value="0"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffApexCrash"/>
          </effect_group>
        </buff>

        <buff name="buffApexCrash" name_key="buffApexCrash" description_key="buffApexCrashDesc" icon="ui_game_symbol_perk" icon_color="255,0,0">
          <stack_type value="replace"/>
          <duration value="0"/>
          <display_value value=".buffApexCrashDisplay"/>
          <display_value_format value="time"/>

          <effect_group>
            &lt;!&ndash; Timer management &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffApexCrashDuration" operation="subtract" value="@$MetabolismDuration"/>
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffApexCrashDisplay" operation="set" value="@$buffApexCrashDuration"/>
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffApexCrashDisplay" operation="divide" value="@$MetabolismDuration"/>
          </effect_group>

          <effect_group>
            &lt;!&ndash; Minimum attributes during crash &ndash;&gt;
            <passive_effect name="AttributeLevel" tags="attStrength,attFortitude,attAgility,attPerception,attIntelligence" operation="base_add" value="-9"/>
            <passive_effect name="PerkLevel" operation="base_set" value="0"/>

            &lt;!&ndash; Buff removal and restoration &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffApexCrash">
              <requirement name="CVarCompare" cvar="$buffApexCrashDuration" operation="LTE" value="0"/>
            </triggered_effect>
          </effect_group>

        </buff>

        <buff name="buffPhoenixRebirth" name_key="buffPhoenixRebirth" description_key="buffPhoenixRebirthDesc" icon="ui_game_symbol_fire" icon_color="255,165,0">
          <stack_type value="replace"/>
          <duration value="0"/>
          <display_value value=".buffPhoenixRebirthDisplay"/>
          <display_value_format value="time"/>

          <effect_group>
            &lt;!&ndash; Timer management &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffPhoenixRebirthDuration" operation="subtract" value="@$MetabolismDuration"/>
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffPhoenixRebirthDisplay" operation="set" value="@$buffPhoenixRebirthDuration"/>
            <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffPhoenixRebirthDisplay" operation="divide" value="@$MetabolismDuration"/>
          </effect_group>

          <effect_group>
            &lt;!&ndash; Visual and sound effects &ndash;&gt;
            <triggered_effect trigger="onSelfBuffStart" action="AttachParticleEffectToEntity" particle="p_onFire"/>
            <triggered_effect trigger="onSelfBuffRemove" action="RemoveParticleEffectFromEntity" particle="p_onFire"/>
            <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="FireMediumLoop" play_in_head="true"/>
            <triggered_effect trigger="onSelfBuffRemove" action="FadeOutSound" sound="FireMediumLoop" play_in_head="true"/>
          </effect_group>

          <effect_group>
            &lt;!&ndash; Lingering benefits &ndash;&gt;
            <passive_effect name="HealthChangeOT" operation="perc_add" value="0.1"/> &lt;!&ndash; Enhanced health regen &ndash;&gt;
            <passive_effect name="ElementalDamageResist" operation="base_add" value="100" tags="heat"/> &lt;!&ndash; Fire immunity &ndash;&gt;
            <passive_effect name="BuffResistance" operation="base_add" value="1" tags="buffInfectionCatch"/> &lt;!&ndash; Disease immunity &ndash;&gt;

            &lt;!&ndash; Auto extinguish any fire &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffExtinguishFire">
              <requirement name="HasBuff" buff="buffIsOnFire"/>
            </triggered_effect>
          </effect_group>

          <effect_group>
            &lt;!&ndash; Buff removal &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffPhoenixRebirth">
              <requirement name="CVarCompare" cvar="$buffPhoenixRebirthDuration" operation="LTE" value="0"/>
            </triggered_effect>
          </effect_group>

          &lt;!&ndash; Safety cleanup &ndash;&gt;
          <effect_group>
            <triggered_effect trigger="onSelfLeaveGame" action="RemoveBuff" buff="buffPhoenixRebirth"/>
            <triggered_effect trigger="onSelfDied" action="RemoveBuff" buff="buffPhoenixRebirth"/>
          </effect_group>
        </buff>

        <buff name="buffGrandpasPower" name_key="buffGrandpasPower" description_key="buffGrandpasPowerDesc" icon="ui_game_symbol_radiation" icon_color="255,0,0">
          <stack_type value="replace"/>
          <duration value="300"/>
          <effect_group>
            &lt;!&ndash; Massive power boost &ndash;&gt;
            <passive_effect name="EntityDamage" operation="perc_add" value="5.0"/>
            <passive_effect name="GeneralDamageResist" operation="base_add" value="5.0"/>
            <passive_effect name="PlayerExpGain" operation="perc_add" value="0.25"/>
            <passive_effect name="StaminaChangeOT" operation="perc_add" value="1.0"/>

            &lt;!&ndash; Visual and particle effects &ndash;&gt;
            <triggered_effect trigger="onSelfBuffStart" action="AttachParticleEffectToEntity" particle="RadiatedParticlesOnMesh" local_offset="0,0.75,0"/>
            <triggered_effect trigger="onSelfBuffRemove" action="RemoveParticleEffectFromEntity" particle="RadiatedParticlesOnMesh"/>
            <triggered_effect trigger="onSelfDied" action="RemoveParticleEffectFromEntity" particle="RadiatedParticlesOnMesh"/>

            &lt;!&ndash; Screen effects &ndash;&gt;
            <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="4" effect_name="Drunk"/>

            &lt;!&ndash; Infection aura &ndash;&gt;
            <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" target="selfAOE" range="5" buff="buffGrandpasInfection">
              <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="25"/>
            </triggered_effect>
          </effect_group>

          &lt;!&ndash; When power ends, apply permanent effects &ndash;&gt;
          <effect_group>
            <triggered_effect trigger="onSelfBuffRemove" action="ModifyStats" stat="Health" operation="perc_set" value="5"/>
            <triggered_effect trigger="onSelfBuffRemove" action="ModifyStats" stat="Food" operation="perc_set" value="5"/>
            <triggered_effect trigger="onSelfBuffRemove" action="ModifyStats" stat="Water" operation="perc_set" value="5"/>

            &lt;!&ndash; Permanent injuries &ndash;&gt;
            <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffLegBroken"/>
            <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffArmBroken"/>
            <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffAbrasionCatch"/>
            <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffLacerationCatch"/>
            <triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="buffInfectionCatch"/>

            &lt;!&ndash; Permanent visual effect &ndash;&gt;
            <triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0.5" effect_name="Distortion"/>
          </effect_group>

          &lt;!&ndash; Safety cleanup &ndash;&gt;
          <effect_group>
            <triggered_effect trigger="onSelfLeaveGame" action="RemoveBuff" buff="buffGrandpasPower"/>
            <triggered_effect trigger="onSelfDied" action="RemoveBuff" buff="buffGrandpasPower"/>
          </effect_group>
        </buff>

        &lt;!&ndash; Infection Spread Effect &ndash;&gt;
        <buff name="buffGrandpasInfection" name_key="buffGrandpasInfection" icon="ui_game_symbol_infection" icon_color="128,0,0">
          <stack_type value="ignore"/>
          <duration value="1"/>
          <effect_group>
            <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffInfectionCatch">
              <requirement name="!HasBuff" target="other" buff="buffInfectionMain"/>
            </triggered_effect>
          </effect_group>
        </buff>-->

  </append>

</hurgleburgler>